openapi: 3.0.3
x-stoplight:
  id: oyf2pt1k0zz67
info:
  title: home-care-navi-second
  version: '1.0'
  description: ②期のホームケアナビのAPI仕様書
  contact:
    name: 平林直樹
    url: 'https://example.com'
    email: test@example.com
  termsOfService: hogehoge
  license:
    name: MIT
    url: 'https://example.com'
servers:
  - url: 'http://localhost:3000/api'
    description: 平林直樹
paths:
  /health_check:
    get:
      summary: ヘルスチェック
      tags:
        - health_check
      responses:
        '200':
          description: OK
          headers: {}
      operationId: get-health-check
      description: ヘルスチェック用のエンドポイントです
  /v1/client_auth/validate_token:
    get:
      summary: 事業所利用者トークン検証
      operationId: validate_token
      description: 'ヘッダー内のaccess-token,client,expiry,uidを検証する'
      parameters: []
      security:
        - access-token: []
        - client: []
        - expiry: []
        - uid: []
      responses:
        '200':
          $ref: '#/components/responses/AuthSuccess'
        '422':
          $ref: '#/components/responses/Error'
      tags:
        - client_auth
    parameters: []
  /v1/client_auth:
    post:
      summary: 事業所利用者新規作成
      operationId: sign_up
      description: 事業所利用者新規登録
      requestBody:
        $ref: '#/components/requestBodies/Registration'
      responses:
        '200':
          $ref: '#/components/responses/AuthSuccess'
        '422':
          $ref: '#/components/responses/Error'
      tags:
        - client_auth
    parameters: []
  /v1/client_auth/sign_in:
    post:
      summary: 事業所利用者ログイン
      operationId: sign_in
      description: 事業所利用者ログイン
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                session:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: test1@example.com
                      description: メールアドレス
                    password:
                      type: string
                      example: password
                      description: パスワード
                  required:
                    - email
                    - password
                  additionalProperties: false
            examples:
              example-1:
                value:
                  session:
                    email: test1@example.com
                    password: password
          application/xml:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          $ref: '#/components/responses/AuthSuccess'
          additionalProperties: false
      tags:
        - client_auth
    parameters: []
  /v1/auth_client/sign_out:
    delete:
      summary: 事業所利用者ログアウト
      operationId: sign_out
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true
                    description: 成功判定
                    readOnly: true
                required:
                  - success
      description: 'ヘッダーに`access-token`,`uid`,`client`必須。ログアウトする。'
      security:
        - access-token: []
        - client: []
        - expiry: []
        - uid: []
      tags:
        - client_auth
    parameters: []
  /v1/offices:
    get:
      summary: 事業所一覧取得
      tags:
        - office
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Office'
              examples:
                example-1:
                  value:
                    - id: 1
                      office_representative_id: 3
                      name: ホームケアナビ事業所
                      feature_title: 楽しいホームケアを提供します
                      feature_detail: 色々なことをします。色々なことをします。色々なことをします。色々なことをします。色々なことをします。
                      business_weekday: 1
                      postal: '1234567'
                      address: 大阪府五泉市窪田町藤泉
                      email: cherrie.wyman@robel.com
                      tel: 1111-11-1111
                      created_at: '2022-08-04T21:47:01.364+09:00'
                      updated_at: '2022-08-04T21:47:01.364+09:00'
                    - id: 2
                      office_representative_id: 4
                      name: ホームケアナビ事業所
                      feature_title: 楽しいホームケアを提供します
                      feature_detail: 色々なことをします。色々なことをします。色々なことをします。色々なことをします。色々なことをします。
                      business_weekday: 1
                      postal: '1234567'
                      address: 高知県清須市住吉町
                      email: cierra.leuschke@hilpert.name
                      tel: 1111-11-1111
                      created_at: '2022-08-04T21:47:01.697+09:00'
                      updated_at: '2022-08-04T21:47:01.697+09:00'
                    - id: 3
                      office_representative_id: 5
                      name: ホームケアナビ事業所
                      feature_title: 楽しいホームケアを提供します
                      feature_detail: 色々なことをします。色々なことをします。色々なことをします。色々なことをします。色々なことをします。
                      business_weekday: 1
                      postal: '1234567'
                      address: 京都府高岡郡越知町米島
                      email: owen_predovic@labadie.com
                      tel: 1111-11-1111
                      created_at: '2022-08-04T21:47:02.025+09:00'
                      updated_at: '2022-08-04T21:47:02.025+09:00'
      operationId: getOffices
      description: 事業所一覧を取得する。
      parameters:
        - schema:
            type: string
            example: 東京 大阪 群馬
          in: query
          name: q
          description: addressを前方一致検索する。OR検索は半角スペースで区切る。
components:
  schemas:
    Client:
      title: Client
      x-stoplight:
        id: ygtg1gffnd7xu
      type: object
      description: 事業所利用者
      properties:
        id:
          type: number
          example: 1
          description: ID
          readOnly: true
        name:
          type: string
          description: 名前
          example: テスト 太郎
        email:
          type: string
          format: email
          example: test@example.com
          description: メールアドレス
        tel:
          type: string
          description: 電話番号
          example: 090-1111-2222
          pattern: '^0[-0-9]{11,12}$'
        postal:
          type: string
          example: '1234567'
          pattern: '^\d{7}$'
          description: 郵便番号
          maxLength: 7
        address:
          type: string
          example: 東京都新宿区市ヶ谷本村町5番1号
          description: 住所
        created_at:
          type: string
          format: date-time
          example: '2022-08-03T00:06:06.514+09:00'
          description: 作成日時
        updated_at:
          type: string
          format: date-time
          example: '2022-08-03T00:06:06.514+09:00'
          description: 更新日時
      required:
        - id
        - name
        - email
        - tel
        - postal
        - address
        - created_at
        - updated_at
    OfficeRepresentative:
      title: OfficeRepresentative
      x-stoplight:
        id: ygtg1gffnd7xu
      type: object
      description: 事業所代表者
      properties:
        id:
          type: number
          example: 1
          description: ID
          readOnly: true
        name:
          type: string
          description: 名前
          example: テスト 太郎
        email:
          type: string
          format: email
          example: test@example.com
          description: メールアドレス
        tel:
          type: string
          description: 電話番号
          example: 090-1111-2222
          pattern: '^0[-0-9]{11,12}$'
        postal:
          type: string
          example: '1234567'
          pattern: '^\d{7}$'
          description: 郵便番号
          maxLength: 7
        address:
          type: string
          example: 東京都新宿区市ヶ谷本村町5番1号
          description: 住所
        created_at:
          type: string
          format: date-time
          example: '2022-08-03T00:06:06.514+09:00'
          description: 作成日時
        updated_at:
          type: string
          format: date-time
          example: '2022-08-03T00:06:06.514+09:00'
          description: 更新日時
      required:
        - id
        - name
        - email
        - tel
        - postal
        - address
        - created_at
        - updated_at
    Office:
      type: object
      x-examples:
        example-1:
          id: 6
          office_representative_id: 8
          name: ホームケアナビ事業所
          feature_title: 楽しいホームケアを提供します
          feature_detail: 色々なことをします。色々なことをします。色々なことをします。色々なことをします。色々なことをします。
          business_weekday: 1
          postal: '1234567'
          address: 群馬県伊佐市七城町台
          email: johnathon@mann.name
          tel: 1111-11-1111
          created_at: '2022-08-04T21:47:02.984+09:00'
          updated_at: '2022-08-04T21:47:02.984+09:00'
      properties:
        id:
          type: integer
          example: 1
          description: 主キー
        office_representative_id:
          type: integer
          example: 1
          description: 事業所代表の外部キー
        feature_title:
          type: string
          example: 楽しいホームケアを提供します
          description: 特徴タイトル
        name:
          type: string
          example: ホームケアナビ事業所
          description: 事業所の名前
        feature_detail:
          type: string
          example: 色々なことをします。色々なことをします。色々なことをします。色々なことをします。色々なことをします。
          description: 特徴テキスト
        business_weekday:
          type: integer
          example: 1
          description: 勤務曜日
        postal:
          type: string
          example: '1234567'
          description: 郵便番号
        address:
          type: string
          example: 群馬県伊佐市七城町台
          description: 住所
        email:
          type: string
          example: johnathon@mann.name
          description: メールアドレス
          format: email
        tel:
          type: string
          example: 1111-11-1111
          description: 電話番号
        created_at:
          type: string
          example: '2022-08-04T21:47:02.984+09:00'
          description: 作成日時
          format: date-time
        updated_at:
          type: string
          example: '2022-08-04T21:47:02.984+09:00'
          description: 更新日時
          format: date-time
      required:
        - id
        - office_representative_id
        - feature_title
        - name
        - feature_detail
        - business_weekday
        - postal
        - address
        - email
        - tel
        - created_at
        - updated_at
  responses:
    AuthSuccess:
      description: ''
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              success:
                type: boolean
                default: true
                description: 成功
                readOnly: true
              data:
                allOf:
                  - type: object
                    description: 認証情報
                    properties:
                      provider:
                        type: string
                        example: email
                        default: email
                        description: emailやOmniauth等の認証方式
                      uid:
                        type: string
                        format: email
                        example: test1@example.com
                        description: ユーザー識別子
                      allow_password_change:
                        type: boolean
                        default: false
                        description: パスワード変更中判定
                        readOnly: true
                    required:
                      - provider
                      - uid
                      - allow_password_change
                  - $ref: '#/components/schemas/Client'
                description: ユーザー及び認証情報
            required:
              - success
              - data
          examples:
            example-1:
              value:
                success: true
                data:
                  provider: email
                  uid: test1@example.com
                  allow_password_change: false
                  id: 1
                  name: テスト 太郎
                  email: test@example.com
                  tel: 090-1111-2222
                  postal: '1234567'
                  address: 東京都新宿区市ヶ谷本村町5番1号
                  created_at: '2022-08-03T00:06:06.514+09:00'
                  updated_at: '2022-08-03T00:06:06.514+09:00'
      headers:
        access-token:
          schema:
            type: string
            example: 7sbMLu90-fDnajzasuhOTQ
          description: トークン認証に必要なヘッダー(1/4)
        client:
          schema:
            type: string
            example: xJ-BFLHzY_XNMX_cjsQnPw
          description: トークン認証に必要なヘッダー(2/4)
        expiry:
          schema:
            type: number
            example: 1660145125
          description: トークン認証に必要なヘッダー(3/4)
        uid:
          schema:
            type: string
            example: test1@example.com
          description: トークン認証に必要なヘッダー(4/4)
    Error:
      description: Example response
      content:
        application/json:
          schema:
            allOf:
              - properties:
                  status:
                    type: string
                    default: error
                    example: error
                    description: エラーステータス
                    readOnly: true
                required:
                  - status
              - properties:
                  data:
                    type: object
                    description: レスポンスによって異なる
                required:
                  - data
              - properties:
                  errors:
                    type: object
                    required:
                      - full_messages
                    description: エラー情報
                    properties:
                      full_messages:
                        type: array
                        description: すべてのエラーメッセージ
                        items:
                          type: string
                          example: メールアドレスはすでに存在します
                required:
                  - errors
            type: object
          examples:
            example-1:
              value:
                status: error
                data: {}
                errors:
                  full_messages:
                    - メールアドレスはすでに存在します
  requestBodies:
    Registration:
      content:
        application/json:
          schema:
            allOf:
              - properties:
                  registration:
                    type: object
                    properties:
                      name:
                        type: string
                        description: 名前
                        example: テスト 太郎
                      email:
                        type: string
                        format: email
                        example: test@example.com
                        description: メールアドレス
                      tel:
                        type: string
                        description: 電話番号
                        example: 090-1111-2222
                        pattern: '^0[-0-9]{11,12}$'
                      postal:
                        type: string
                        example: '1234567'
                        pattern: '^\d{7}$'
                        description: 郵便番号
                        maxLength: 7
                      address:
                        type: string
                        example: 東京都新宿区市ヶ谷本村町5番1号
                        description: 住所
                      password:
                        type: string
                        example: password
                        description: パスワード
                    required:
                      - name
                      - email
                      - tel
                      - postal
                      - address
                      - password
              - properties:
                  confirm_success_url:
                    type: string
                    format: uri
                    example: 'https://www.home-care-navi-second'
                    description: アカウント登録メールに記載されるURL
                required:
                  - confirm_success_url
            type: object
          examples:
            example-1:
              value:
                registration:
                  name: テスト 太郎
                  email: test@example.com
                  tel: 090-1111-2222
                  postal: '1234567'
                  address: 東京都新宿区市ヶ谷本村町5番1号
                  password: password
                confirm_success_url: 'https://www.home-care-navi-second'
      description: ''
  parameters:
    access-token:
      name: access-token
      in: header
      required: true
      schema:
        type: string
        example: 7sbMLu90-fDnajzasuhOTQ
      description: トークン認証に必要なヘッダー(1/4)
    client:
      name: client
      in: header
      required: true
      schema:
        type: string
        example: xJ-BFLHzY_XNMX_cjsQnPw
      description: トークン認証に必要なヘッダー(2/4)
    expiry:
      name: expiry
      in: header
      required: true
      schema:
        type: number
        example: 1660145125
      description: トークン認証に必要なヘッダー(3/4)
    uid:
      name: uid
      in: header
      required: true
      schema:
        type: string
        example: test1@example.com
      description: トークン認証に必要なヘッダー(4/4)
  securitySchemes:
    access-token:
      name: access-token
      type: apiKey
      in: header
      description: トークン認証に必要なヘッダー(1/4)
    client:
      name: client
      type: apiKey
      in: header
      description: トークン認証に必要なヘッダー(2/4)
    expiry:
      name: expiry
      type: apiKey
      in: header
      description: トークン認証に必要なヘッダー(3/4)
    uid:
      name: uid
      type: apiKey
      in: header
      description: トークン認証に必要なヘッダー(4/4)
tags:
  - name: client_auth
    description: 事業所利用者の認証
  - name: health_check
    description: ヘルスチェック関連
